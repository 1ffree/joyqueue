/*
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
webpackJsonp([20,46],{"/QCk":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("T0gc"),s=a("fo4W"),i=a("95hR"),o=a("2Hqc"),r=a("toiR"),l={name:"userToken",components:{myTable:n.a,myDialog:s.a,apiToken:o.default},mixins:[i.a],data:function(){return{searchData:{keyword:""},urls:{search:"/user/userToken/search",del:"/user/userToken/delete"},searchRules:{},tableData:{rowData:[],colData:[{title:"erp",key:"code"},{title:"令牌",key:"token"},{title:"过期时间",key:"expireTime",formatter:function(t){return Object(r.b)(t.createTime)}}],btns:[{txt:"编辑  ",method:"on-edit"},{txt:"删除  ",method:"on-del"}]},multipleSelection:[],editDialog:{visible:!1,title:"令牌编辑",showFooter:!1},editData:{code:"",token:"",expireTime:""}}},methods:{onEdit:function(t){this.editData=t,this.openDialog("editDialog")},openDialog:function(t){this[t].visible=!0,this.addData.code=""}},mounted:function(){this.getList()}},c={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"ml20 mt30"},[a("d-input",{staticClass:"left mr10",staticStyle:{width:"20%"},attrs:{placeholder:"请输入erp"},model:{value:t.searchData.keyword,callback:function(e){t.$set(t.searchData,"keyword",e)},expression:"searchData.keyword"}},[a("icon",{attrs:{slot:"suffix",name:"search",size:"14",color:"#CACACA"},on:{click:t.getList},slot:"suffix"})],1)],1),t._v(" "),a("my-table",{attrs:{data:t.tableData,showPin:t.showTablePin,page:t.page},on:{"on-size-change":t.handleSizeChange,"on-current-change":t.handleCurrentChange,"on-selection-change":t.handleSelectionChange,"on-edit":t.onEdit,"on-del":t.del}}),t._v(" "),a("my-dialog",{attrs:{dialog:t.editDialog},on:{"on-dialog-confirm":function(e){return t.editConfirm()},"on-dialog-cancel":function(e){return t.editCancel()}}},[a("api-token",{ref:"editForm",attrs:{data:t.editData}})],1)],1)},staticRenderFns:[]};var d=a("VU/8")(l,c,!1,function(t){a("lKhL")},"data-v-0c6098c4",null);e.default=d.exports},"2Hqc":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("IcnI"),s=a("95hR"),i=a("1a0f"),o=a("toiR"),r={name:"api-token",mixins:[s.a],props:{type:0,data:{type:Object,default:function(){return{code:n.a.getters.loginUserName,token:"",expireTime:null}}}},data:function(){return{formData:this.data,urls:{search:"/user/userToken",update:"/user/updateToken",invalid:"/user/invalidToken"},rules:{},months:"12"}},methods:{getList:function(){var t=this;i.a.get(this.urls.search+"/"+this.formData.code,{}).then(function(e){e.data=e.data||{},t.formData=e.data})},addMonth:function(t,e){e=parseInt(e);for(var a=t,n=a.getFullYear(),s=a.getMonth()+1+e,i=a.getDate();s>12;)n++,s-=12;for(var o=new Date(n,s-1,i);o.getMonth()!=s-1;)i--,o=new Date(n,s-1,i);return o},timestampToStr:function(t){return Object(o.b)(t)},invalidToken:function(){var t=this;i.a.put(this.urls.invalid+"/"+this.formData.code,{}).then(function(e){e.data=e.data||{},"success"===e.data?(t.$Message.success("更新成功"),t.getList()):t.$Message.error("更新失败")})},updateToken:function(){var t=this,e=parseInt(this.months),a=new Date,s=(a=this.addMonth(a,e)).getTime(),o={code:n.a.getters.loginUserName,expireTime:s};i.a.postBase(this.urls.update,{},o,!1).then(function(e){e.data=e.data||{},"success"===e.data?(t.$Message.success("更新成功"),t.getList()):t.$Message.error("更新失败")})}},mounted:function(){this.getList()}},l={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"ml20 mt30"},[a("d-form",{ref:"form",attrs:{model:t.formData,rules:t.rules,"label-width":"100px"}},[a("d-form-item",{attrs:{label:"用户名："}},[a("grid-col",{staticClass:"label",attrs:{span:2}},[a("span",[t._v(t._s(t.formData.code))])])],1),t._v(" "),null!=t.formData.token?a("d-form-item",{attrs:{label:"令牌:"}},[a("span",[t._v(t._s(t.formData.token))])]):t._e(),t._v(" "),null!=t.formData.token?a("d-form-item",{attrs:{label:"有效期限:"}},[a("span",[t._v(t._s(t.timestampToStr(t.formData.expireTime,!1,!1)))])]):t._e(),t._v(" "),a("d-form-item",{attrs:{label:"有效期:"}},[t.$store.getters.isAdmin?a("d-select",{staticClass:"left",staticStyle:{width:"200px"},attrs:{placeholder:"请选择有效期"},model:{value:t.months,callback:function(e){t.months=e},expression:"months"}},[a("d-option",{attrs:{value:"6"}},[t._v("六个月")]),t._v(" "),a("d-option",{attrs:{value:"12"}},[t._v("十二个月")]),t._v(" "),a("d-option",{attrs:{value:"36"}},[t._v("三年")])],1):t._e()],1),t._v(" "),a("div",{staticClass:"ml20 mt30",staticStyle:{"margin-top":"20px","margin-left":"20px"}},[a("d-button",{staticClass:"left mr10",on:{click:function(e){return t.invalidToken()}}},[t._v("过期")]),t._v(" "),a("d-button",{staticClass:"left mr10",attrs:{type:"primary"},on:{click:function(e){return t.updateToken()}}},[t._v("更新")])],1)],1)],1)])},staticRenderFns:[]};var c=a("VU/8")(r,l,!1,function(t){a("PEPC")},"data-v-3ef3e382",null);e.default=c.exports},PEPC:function(t,e){},lKhL:function(t,e){}});
//# sourceMappingURL=20.54482c58a230a1b55618.js.map