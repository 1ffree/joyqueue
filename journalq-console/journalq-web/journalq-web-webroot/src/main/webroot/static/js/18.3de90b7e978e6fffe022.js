webpackJsonp([18],{HHfc:function(t,a){},c5DE:function(t,a,i){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var o=i("1a0f"),e=i("T0gc"),r=i("fo4W"),n=i("+Ohd"),l=i("JSa9"),s=i("GPRu"),c=i("9xs8"),g=i("tdWL"),p=i("95hR"),u=i("X2Oc"),d={name:"partitionGroup",components:{GroupPosition:s.default,myTable:e.a,myDialog:r.a,groupDetail:n.default,groupScale:l.default,groupMerge:c.default,groupNew:g.default},mixins:[p.a],props:{showHostChart:{type:Boolean,default:!1},showBrokerChart:{type:Boolean,default:!1}},data:function(){return{urls:{search:"/partitionGroup/search",del:"/partitionGroup/delete",getBroker:"/broker/get",addPartition:"/partitionGroup/addPartition",removePartition:"/partitionGroup/removePartition",getMonitor:"/monitor",getUrl:"/grafana/getRedirectUrl"},searchData:{topic:{id:this.$route.query.id,code:this.$route.query.code},namespace:{id:this.$route.query.namespaceId,code:this.$route.query.namespaceCode},keyword:""},tableData:{rowData:[],colData:[{title:"group",width:"2%",key:"groupNo"},{title:"partitions",width:"15%",key:"partitions"},{title:"选举类型",width:"5%",key:"electType",render:function(t,a){var i=void 0;switch(a.item.electType){case 0:i="raft";break;case 1:i="fix"}return t("label",{},i)}},{title:"副本数",width:"2%",key:"replicas"},{title:"当前leader",width:"15%",key:"ip",formatter:function(t){return t.leader+":"+t.ip}},{title:"推荐leader",width:"10%",key:"recLeader"},{title:"isr",key:"isr"},{title:"term",width:"2%",key:"term"}],btns:[{txt:"详情",method:"on-view-detail"},{txt:"增加副本数",method:"on-scale"},{txt:"减副本数",method:"on-merge"},{txt:"删除",method:"on-del"},{txt:"增加分区",method:"on-addPartition"},{txt:"减少分区",method:"on-removePartition"},{txt:"主从同步监控",method:"on-position"}]},groupDetailDialog:{visible:!1,title:"详情",width:800,showFooter:!1},groupDetailDialogData:{},positionDialog:{visible:!1,title:"主从同步监控",width:800,showFooter:!1},positionDialogData:{},groupScaleDialog:{visible:!1,title:"增加副本",width:800,showFooter:!1},groupScaleDialogData:{},groupMergeDialog:{visible:!1,title:"减少副本",width:800,showFooter:!1},groupMergeDialogData:{},addPartitionDialog:{visible:!1,title:"增加分区数",width:500,showFooter:!0},addPartitionDialogData:{},removePartitionDialog:{visible:!1,title:"减少分区数",width:800,showFooter:!0},removePartitionDialogData:{},groupNewDialog:{visible:!1,title:"详情",width:800,showFooter:!1},groupNewDialogData:{topic:this.$route.query.topic,namespace:this.$route.query.namespace,electType:0,replicaGroups:[],partitions:0},newGroupData:{}}},computed:{},methods:{getList:function(){var t=this;this.showTablePin=!0;var a={pagination:{page:this.page.page,size:this.page.size},query:{topic:this.searchData.topic,namespace:this.searchData.namespace,keyword:this.searchData.keyword}};o.a.post(this.urlOrigin.search,{},a).then(function(a){a.data=a.data||[],a.pagination=a.pagination||{totalRecord:a.data.length},t.page.total=a.pagination.totalRecord,t.page.page=a.pagination.page,t.page.size=a.pagination.size,t.tableData.rowData=a.data;for(var i=0;i<t.tableData.rowData.length;i++)t.getBroker(t.tableData.rowData,i);t.showTablePin=!1})},getBroker:function(t,a){var i=this;o.a.get(this.urlOrigin.getBroker+"/"+t[a].leader).then(function(t){i.tableData.rowData[a].ip=t.data.ip,i.$set(i.tableData.rowData,a,i.tableData.rowData[a])})},goBrokerChart:function(){var t=this;o.a.get(this.urls.getUrl+"/broker",{},{}).then(function(a){var i=a.data||"";i.indexOf("?")<0?i+="?":i.endsWith("?")||(i+="&"),i=i+"var-topic="+Object(u.i)(t.searchData.topic,t.searchData.namespace),window.open(i)})},goHostChart:function(){var t=this;o.a.get(this.urls.getUrl+"/host",{},{}).then(function(a){var i=a.data||"";i.indexOf("?")<0?i+="?":i.endsWith("?")||(i+="&"),i=i+"var-topic="+Object(u.i)(t.searchData.topic,t.searchData.namespace),window.open(i)})},goDetail:function(t){this.groupDetailDialogData={groupNo:t.groupNo,topic:this.searchData.topic,namespace:this.searchData.namespace},this.groupDetailDialog.visible=!0},groupDetailConfirm:function(){},groupDetailCancel:function(){this.groupDetailDialog.visible=!1},goPosition:function(t){this.positionDialogData={groupNo:t.groupNo,topic:this.searchData.topic,namespace:this.searchData.namespace},this.positionDialog.visible=!0},positionConfirm:function(){},positionCancel:function(){this.positionDialog.visible=!1},groupScale:function(t){this.groupScaleDialogData={groupNo:t.groupNo,topic:{id:t.topic.id,code:t.topic.code},namespace:{id:t.namespace.id,code:t.namespace.code}},this.groupScaleDialog.visible=!0},groupScaleConfirm:function(){},groupScaleCancel:function(){this.groupScaleDialog.visible=!1},groupNewConfirm:function(){},groupNewCancel:function(){this.groupNewDialog.visible=!1,this.getList()},groupNew:function(){this.groupNewDialogData={topic:this.searchData.topic,namespace:this.searchData.namespace},this.groupNewDialog.visible=!0},groupMerge:function(t){this.groupMergeDialog.visible=!0,this.groupMergeDialogData={groupNo:t.groupNo,topic:{id:t.topic.id,code:t.topic.code},namespace:{id:t.namespace.id,code:t.namespace.code}}},groupMergeConfirm:function(){},groupMergeCancel:function(){this.groupMergeDialog.visible=!1,this.getList()},addPartition:function(t){this.addPartitionDialog.visible=!0,this.addPartitionDialogData=t},addPartitionConfirm:function(){var t=this;this.addPartitionDialogData.partitionsCount<=0||o.a.post(this.urls.addPartition,{},this.addPartitionDialogData).then(function(){t.addPartitionDialog.visible=!1,t.getList()})},addPartitionCancel:function(){this.addPartitionDialog.visible=!1},removePartition:function(t){this.removePartitionDialog.visible=!0,this.removePartitionDialogData=t},removePartitionConfirm:function(){var t=this;this.removePartitionDialogData.partitionsCount<=0||o.a.post(this.urls.removePartition,{},this.removePartitionDialogData).then(function(a){t.removePartitionDialog.visible=!1,t.getList()})},removePartitionCancel:function(){this.removePartitionDialog.visible=!1},del:function(t){var a=this,i=t;o.a.post(this.urls.del,{},i).then(function(){a.getList()})},topicUpdate:function(){this.$emit("on-partition-group-change")},afterDel:function(){this.topicUpdate()}},mounted:function(){}},h={render:function(){var t=this,a=t.$createElement,i=t._self._c||a;return i("div",[i("div",{staticClass:"ml20 mt30"},[i("d-button",{staticClass:"left mr10",attrs:{type:"primary"},on:{click:t.groupNew}},[t._v("\n      扩容\n      "),i("icon",{staticStyle:{"margin-left":"5px"},attrs:{name:"plus-circle"}})],1),t._v(" "),t._t("extendBtns"),t._v(" "),t.showBrokerChart?i("d-button",{staticClass:"left mr10",attrs:{type:"primary"},on:{click:t.goBrokerChart}},[t._v("\n      Broker监控\n      "),i("icon",{staticStyle:{"margin-left":"5px"},attrs:{name:"bar-chart"}})],1):t._e(),t._v(" "),t.showHostChart?i("d-button",{staticClass:"left mr10",attrs:{type:"primary"},on:{click:t.goHostChart}},[t._v("\n      主机监控\n      "),i("icon",{staticStyle:{"margin-left":"5px"},attrs:{name:"bar-chart"}})],1):t._e()],2),t._v(" "),i("my-table",{attrs:{data:t.tableData,showPin:t.showTablePin,page:t.page},on:{"on-size-change":t.handleSizeChange,"on-current-change":t.handleCurrentChange,"on-view-detail":t.goDetail,"on-scale":t.groupScale,"on-merge":t.groupMerge,"on-del":t.del,"on-addPartition":t.addPartition,"on-removePartition":t.removePartition,"on-position":t.goPosition}}),t._v(" "),i("my-dialog",{attrs:{dialog:t.groupDetailDialog},on:{"on-dialog-confirm":function(a){return t.groupDetailConfirm()},"on-dialog-cancel":function(a){return t.groupDetailCancel()}}},[i("group-detail",{attrs:{data:t.groupDetailDialogData}})],1),t._v(" "),i("my-dialog",{attrs:{dialog:t.groupScaleDialog},on:{"on-dialog-confirm":function(a){return t.groupScaleConfirm()},"on-dialog-cancel":function(a){return t.groupScaleCancel()}}},[i("group-scale",{attrs:{data:t.groupScaleDialogData}})],1),t._v(" "),i("my-dialog",{attrs:{dialog:t.groupMergeDialog},on:{"on-dialog-confirm":function(a){return t.groupMergeConfirm()},"on-dialog-cancel":function(a){return t.groupMergeCancel()}}},[i("group-merge",{attrs:{data:t.groupMergeDialogData}})],1),t._v(" "),i("my-dialog",{attrs:{dialog:t.positionDialog},on:{"on-dialog-confirm":function(a){return t.positionConfirm()},"on-dialog-cancel":function(a){return t.positionCancel()}}},[i("group-position",{attrs:{data:t.positionDialogData}})],1),t._v(" "),i("my-dialog",{attrs:{dialog:t.addPartitionDialog},on:{"on-dialog-confirm":function(a){return t.addPartitionConfirm()},"on-dialog-cancel":function(a){return t.addPartitionCancel()}}},[i("d-input",{staticStyle:{width:"400px"},attrs:{placeholder:"请输入增加分区数"},model:{value:t.addPartitionDialogData.partitionCount,callback:function(a){t.$set(t.addPartitionDialogData,"partitionCount",a)},expression:"addPartitionDialogData.partitionCount"}},[i("span",{attrs:{slot:"prepend"},slot:"prepend"},[t._v("增加分区数")])])],1),t._v(" "),i("my-dialog",{attrs:{dialog:t.removePartitionDialog},on:{"on-dialog-confirm":function(a){return t.removePartitionConfirm()},"on-dialog-cancel":function(a){return t.removePartitionCancel()}}},[i("d-input",{staticStyle:{width:"400px"},attrs:{placeholder:"请输入减少分区数"},model:{value:t.removePartitionDialogData.partitionCount,callback:function(a){t.$set(t.removePartitionDialogData,"partitionCount",a)},expression:"removePartitionDialogData.partitionCount"}},[i("span",{attrs:{slot:"prepend"},slot:"prepend"},[t._v("减少分区数")])])],1),t._v(" "),i("my-dialog",{attrs:{dialog:t.groupNewDialog},on:{"on-dialog-confirm":function(a){return t.groupNewConfirm()},"on-dialog-cancel":function(a){return t.groupNewCancel()}}},[i("group-new",{attrs:{data:t.groupNewDialogData},on:{"on-dialog-confirm":function(a){return t.groupNewConfirm()},"on-dialog-cancel":function(a){return t.groupNewCancel()},"on-partition-group-change":t.topicUpdate}})],1)],1)},staticRenderFns:[]};var D=i("VU/8")(d,h,!1,function(t){i("HHfc")},"data-v-a5a220e8",null);a.default=D.exports}});
//# sourceMappingURL=18.3de90b7e978e6fffe022.js.map