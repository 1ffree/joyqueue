webpackJsonp([1,44],{"3p6A":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=a("1a0f"),o=a("vcXF"),i=a("T0gc"),s=a("fo4W"),n=a("W9DL"),d=a("95hR"),l=a("iPXC"),c={name:"topic",components:{myTable:i.a,myDialog:s.a,topicForm:n.default},mixins:[d.a],data:function(){var t=this;return{searchData:{keyword:"",command:1},tableData:{rowData:[],colData:[{title:"ID",key:"id"},{title:"英文名",key:"code",render:function(e,a){return e("label",{style:{cursor:"pointer",color:"#3366FF"},on:{click:function(){t.$router.push({name:"/"+t.$i18n.locale+"/topic/detail",query:{id:a.item.id,code:a.item.code,namespaceId:a.item.namespace.id,namespaceCode:a.item.namespace.code}})}}},a.item.code)}},{title:"类型",key:"type",render:function(t,e){var a=void 0;switch(e.item.type){case 0:a="topic";break;case 1:a="broadcast";break;case 2:a="seuqential"}return t("label",{},a)}},{title:"队列数",key:"partitions"},{title:"归档",key:"archive",render:function(t,e){var a=e.item.archive?"已开启":"已关闭";return t("DButton",{props:{size:"small",borderless:!0,color:e.item.archive?"success":"warning"}},a)}}],btns:[{txt:"详情",method:"on-view-detail"},{txt:"主机监控",method:"on-hosts"},{txt:"删除",method:"on-del"}]},addDialog:{visible:!1,title:"添加主题",width:700,showFooter:!1},addData:{},editDialog:{visible:!1,title:"编辑主题",width:700,showFooter:!0},editData:{},editLabelDialog:{visible:!1,title:"编辑主题标签",width:700,showFooter:!0},editLabelData:{},addBrokerGroupDialog:{visible:!1,title:"添加分组",width:700,showFooter:!0},addBrokerGroupData:{}}},computed:{},methods:{goDetail:function(t){this.$router.push({name:"/"+this.$i18n.locale+"/topic/detail",query:{id:t.id,code:t.code,namespaceId:t.namespace.id,namespaceCode:t.namespace.code}})},editLabel:function(t){this.openDialog("editLabelDialog"),r.a.get(o.a["/topic"].editLabelData+"/"+t.id).then(function(t){}),this.editLabelData=t},editLabelConfirm:function(){var t=this,e={id:this.editLabelData.id,bs:this.editLabelData.bs,labels:[{bs:this.editLabelData.bs}]};r.a.post(this.urlOrigin.editLabel,{},e).then(function(e){t.editLabelDialog.visible=!1,t.$Dialog.success({content:"修改成功"}),t.getList()})},editLabelCancel:function(){this.editLabelDialog.visible=!1},addBrokerGroup:function(t){this.openDialog("addBrokerGroupDialog"),this.addBrokerGroupData=t,this.addBrokerGroupData.brokerGroupsAdd=[]},addBrokerGroupConfirm:function(){var t=this,e=this.addBrokerGroupData;r.a.post(this.urlOrigin.addBrokerGroup,{},e).then(function(e){t.addBrokerGroupDialog.visible=!1,t.$Dialog.success({content:"添加成功"}),t.getList()})},addBrokerGroupCancel:function(){this.addBrokerGroupDialog.visible=!1},choosedBrokerGroup:function(t){this.addBrokerGroupData.brokerGroupsAdd=t},isAdmin:function(t){return this.$store.getters.isAdmin},goHostChart:function(t){var e=this;r.a.get(o.a["/topic"].getUrl+"/hosts",{},{}).then(function(a){var r=a.data||"";r.indexOf("?")<0?r+="?":r.endsWith("?")||(r+="&"),r=r+"var-topic="+t.code;var o=l.a.get(e.$store.getters.cookieName);null!=o?(r=r+"&var-cookie="+e.$store.getters.cookieName+"="+o,window.open(r)):e.$Message.error("cookie获取失败！")})}},mounted:function(){this.getList()}},p={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"ml20 mt30"},[a("d-input",{staticClass:"left",staticStyle:{width:"12%"},attrs:{placeholder:"请输入英文名"},model:{value:t.searchData.keyword,callback:function(e){t.$set(t.searchData,"keyword",e)},expression:"searchData.keyword"}}),t._v(" "),a("d-select",{staticClass:"left",staticStyle:{width:"12%"},attrs:{placeholder:"请选择类型"},model:{value:t.searchData.type,callback:function(e){t.$set(t.searchData,"type",e)},expression:"searchData.type"}},[a("d-option",{attrs:{value:"-1"}},[t._v("全部")]),t._v(" "),a("d-option",{attrs:{value:"0"}},[t._v("普通主题")]),t._v(" "),a("d-option",{attrs:{value:"1"}},[t._v("广播主题")]),t._v(" "),a("d-option",{attrs:{value:"2"}},[t._v("顺序主题")])],1),t._v(" "),a("d-button",{attrs:{type:"primary"},on:{click:t.getList}},[t._v("查询"),a("icon",{staticStyle:{"margin-left":"5px"},attrs:{name:"search"}})],1),t._v(" "),t.$store.getters.isAdmin?a("d-button",{attrs:{type:"primary"},on:{click:function(e){return t.openDialog("addDialog")}}},[t._v("添加主题"),a("icon",{staticStyle:{"margin-left":"5px"},attrs:{name:"plus-circle"}})],1):t._e()],1),t._v(" "),a("my-table",{attrs:{data:t.tableData,showPin:t.showTablePin,page:t.page},on:{"on-size-change":t.handleSizeChange,"on-current-change":t.handleCurrentChange,"on-selection-change":t.handleSelectionChange,"on-view-detail":t.goDetail,"on-edit":t.edit,"on-edit-label":t.editLabel,"on-add-brokerGroup":t.addBrokerGroup,"on-del":t.del,"on-hosts":t.goHostChart}}),t._v(" "),a("my-dialog",{staticClass:"add-dialog",attrs:{dialog:t.addDialog},on:{"on-dialog-cancel":function(e){return t.dialogCancel("addDialog")}}},[a("topic-form",{attrs:{type:t.$store.getters.addFormType},on:{"on-dialog-cancel":function(e){return t.dialogCancel("addDialog")}}})],1),t._v(" "),a("my-dialog",{attrs:{dialog:t.editLabelDialog},on:{"on-dialog-confirm":function(e){return t.editLabelConfirm()},"on-dialog-cancel":function(e){return t.editLabelCancel()}}},[a("grid-row",{staticClass:"mb10"},[a("grid-col",{staticClass:"label",attrs:{span:4}},[t._v("业务分组:")]),t._v(" "),a("grid-col",{staticClass:"val",attrs:{span:20}},[a("d-select",{staticClass:"left",model:{value:t.editLabelData.bs,callback:function(e){t.$set(t.editLabelData,"bs",e)},expression:"editLabelData.bs"}},[a("d-option",{attrs:{value:"sc"}},[t._v("商城")]),t._v(" "),a("d-option",{attrs:{value:"jr"}},[t._v("金融")])],1)],1)],1)],1),t._v(" "),a("my-dialog",{attrs:{dialog:t.addBrokerGroupDialog},on:{"on-dialog-confirm":function(e){return t.addBrokerGroupConfirm()},"on-dialog-cancel":function(e){return t.addBrokerGroupCancel()}}},[a("add-brokerGroup",{attrs:{data:t.addBrokerGroupData},on:{"on-choosed-brokerGroup":t.choosedBrokerGroup}})],1)],1)},staticRenderFns:[]};var u=a("VU/8")(c,p,!1,function(t){a("rA3o")},"data-v-5b58824f",null);e.default=u.exports},Rw2U:function(t,e){},W9DL:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=a("1a0f"),o=a("M3bc"),i=a("X2Oc"),s=a("lcoF"),n=a("H/ue"),d={name:"topic-form",mixins:[s.a],components:{addBroker:n.default},props:{type:0,data:{type:Object,default:function(){return{code:"",name:"",type:0,namespace:{id:"0",code:""},partitions:5,brokerGroup:{id:0,code:"",name:""},electType:0,description:"",brokers:[]}}}},data:function(){var t=this;return{current:0,formData:this.data,namespaceList:[],brokerGroupList:[],brokerList:[],urls:{findAllNamespace:"/namespace/findAll",findAllBrokerGroup:"/brokerGroup/findAll",searchBroker:"/broker/search",add:"/topic/addWithBrokerGroup"},rules:{rule1:{code:[{required:!0,message:"请输入topic英文名",trigger:"change"},{pattern:/^[a-zA-Z/]+[a-zA-Z0-9/_-]{1,120}[a-zA-Z0-9/]+$/,message:"英文名格式不匹配",trigger:"change"}],name:Object(i.h)(),partitions:[{type:"number",required:!0,message:"请输入队列数量",trigger:"change"}],brokerGroup:[{required:!0,message:"请选择一个分组",trigger:"change"}]},rule2:{brokers:[{type:"array",required:!0,message:"请至少选择一个Broker",trigger:"change"},{validator:function(e,a,r){void 0!==t.formData.topic.partitions&&void 0!==t.formData.topic.brokers&&t.formData.topic.brokers.length>t.formData.topic.partitions?r(new Error("勾选的broker数量不能大于队列数量")):r()},trigger:"blur"}]}},error:{code:""}}},methods:{prev:function(){this.current=this.current-1},next:function(){var t=this;this.$refs["form"+(this.current+1)].validate(function(e){e?t.current=t.current+1:t.$Message.error("验证不通过，请重新填写！")})},choosedBroker:function(t){this.formData.brokers=t},handlerBrokerGroupChange:function(t){this.$refs.brokers.getListByGroup(t)},getNamespaces:function(){var t=this;r.a.get(this.urls.findAllNamespace).then(function(e){t.namespaceList=e.data||[]})},getBrokerGroups:function(){var t=this;r.a.get(this.urls.findAllBrokerGroup).then(function(e){(void 0===e.data||e.data.length<1)&&(t.brokerGroupList=[{id:0,code:"",name:"全部"}]),t.brokerGroupList=[];t.brokerGroupList.push({id:0,code:"",name:"全部"}),(e.data||[]).forEach(function(e){t.brokerGroupList.push(e)})})},beforeConfirm:function(){return Object(o.e)(this.formData||{})}},computed:{},mounted:function(){this.getNamespaces(),this.getBrokerGroups()}},l={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("d-steps",{attrs:{current:t.current}},[a("d-step",{attrs:{title:"步骤1",description:"主题信息"}}),t._v(" "),a("d-step",{attrs:{title:"步骤2",description:"Broker列表"}})],1),t._v(" "),a("div",{staticClass:"steps-content",staticStyle:{"margin-top":"15px",border:"1px solid #e9e9e9","border-radius":"6px","min-height":"200px","text-align":"left",padding:"20px 30px 40px 50px"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:0===t.current,expression:"current===0"}],staticClass:"step1"},[a("div",{staticClass:"stepForm1"},[a("d-form",{ref:"form1",staticStyle:{height:"350px","overflow-y":"auto",width:"100%"},attrs:{model:t.formData,rules:t.rules.rule1,"label-width":"110px"}},[a("d-form-item",{attrs:{label:"主题英文名：",error:t.error.code,prop:"code"}},[a("d-input",{staticStyle:{width:"70%"},attrs:{placeholder:"仅支持英文字母大小写、数字、-、_和/"},model:{value:t.formData.code,callback:function(e){t.$set(t.formData,"code",e)},expression:"formData.code"}})],1),t._v(" "),a("d-form-item",{attrs:{label:"队列数量：",prop:"partitions"}},[a("d-input",{staticStyle:{width:"70%"},model:{value:t.formData.partitions,callback:function(e){t.$set(t.formData,"partitions",t._n(e))},expression:"formData.partitions"}})],1),t._v(" "),a("d-form-item",{attrs:{label:"主题类型：",prop:"type"}},[a("d-select",{staticStyle:{width:"70%"},attrs:{value:0},model:{value:t.formData.type,callback:function(e){t.$set(t.formData,"type",e)},expression:"formData.type"}},[a("d-option",{attrs:{value:0}},[t._v("普通主题")]),t._v(" "),a("d-option",{attrs:{value:1}},[t._v("广播主题")]),t._v(" "),a("d-option",{attrs:{value:2}},[t._v("顺序主题")])],1)],1),t._v(" "),a("d-form-item",{attrs:{label:"选举类型：",prop:"electType"}},[a("d-select",{staticStyle:{width:"70%"},model:{value:t.formData.electType,callback:function(e){t.$set(t.formData,"electType",t._n(e))},expression:"formData.electType"}},[a("d-option",{attrs:{value:0}},[t._v("Raft")]),t._v(" "),a("d-option",{attrs:{value:1}},[t._v("Fix")])],1)],1),t._v(" "),a("d-form-item",{attrs:{label:"分组：",prop:"brokerGroup"}},[a("d-select",{staticStyle:{width:"70%"},on:{"on-change":t.handlerBrokerGroupChange},model:{value:t.formData.brokerGroup.id,callback:function(e){t.$set(t.formData.brokerGroup,"id",e)},expression:"formData.brokerGroup.id"}},t._l(t.brokerGroupList,function(e){return a("d-option",{key:e.id,attrs:{value:e.id}},[a("span",[t._v(t._s(e.name))]),t._v(" "),a("span",{staticStyle:{float:"right",color:"#ccc"}},[t._v(t._s(e.code))])])}),1)],1),t._v(" "),a("d-form-item",{attrs:{label:"备注：",prop:"description"}},[a("d-input",{staticStyle:{width:"70%"},attrs:{type:"textarea",rows:"2",placeholder:"请输入备注说明，例如用途等"},model:{value:t.formData.description,callback:function(e){t.$set(t.formData,"description",e)},expression:"formData.description"}})],1)],1)],1),t._v(" "),a("div",{staticClass:"step-actions",staticStyle:{"text-align":"center"}},[a("d-button",{attrs:{type:"primary"},on:{click:t.next}},[t._v("下一步")])],1)]),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:1===t.current,expression:"current===1"}],staticClass:"step2"},[a("div",{staticClass:"stepForm2"},[a("d-form",{ref:"form",staticStyle:{"overflow-y":"auto",height:"350px"},attrs:{model:t.formData,rules:t.rules.rule2,"label-width":"100px"}},[a("add-broker",{ref:"brokers",attrs:{model:t.formData.brokers,data:t.formData},on:{"on-choosed-broker":t.choosedBroker}})],1)],1),t._v(" "),a("div",{staticClass:"step-actions",staticStyle:{"text-align":"center"}},[a("d-button",{attrs:{type:"primary"},on:{click:t.prev}},[t._v("上一步")]),t._v(" "),a("d-button",{attrs:{type:"primary"},on:{click:function(e){return t.confirm()}}},[t._v("确定")])],1)])])],1)},staticRenderFns:[]};var c=a("VU/8")(d,l,!1,function(t){a("Rw2U")},"data-v-46a252d3",null);e.default=c.exports},rA3o:function(t,e){}});
//# sourceMappingURL=1.03c78c83414f5cb50a21.js.map