# 性能评测

JournalQ是一个高吞吐、低延迟和可扩展的多协议分布式发布/订阅消息中间件。如果打算将JournalQ部署到生产环境，你可能对它的性能比较感兴趣。本文，设计了简单的测试用例来测试JournalQ单实例的性能。


## 设置

实验中，采用了如下的硬件设备：

* Intel(R) Xeon(R) CPU E5-2620 v4 @ 2.10GHz with 8 cores x 2
* 32GB x 8 RAM
* 960GB x 6 SSD  
* 10 Gigabit Ethernet


## 测试用例

创建一个包含200个分区的主题，压缩算法采用LZ4,单条消息体1kB。一方面，选择同步还是异步消息将影响生产者的性能，生产者不必阻塞等待异步消息的生产结果使得它可以不停的发送消息以及选择何时处理消息的返回结果。另一方面，大的批量消息及消息压缩将极大的提高生产者的性能，实验中采用如下的测试用例：

* 示例1：同步生产，单条消息
* 示例2：同步生产，带压缩单条消息
* 示例3：异步生产，带压缩，批量100条消息
* 示例4：异步生产，带压缩，批量100条消息，以及60个消费者


## 实验结果及总结

实验中，每个测试用例持续10分种，生产者线程数是由具体实验设定，由CPU、网络和磁盘的瓶颈所决定。实验结果如下表：

| case | CPU(%) |Mem(%)| Network I/O(MB/s) | Disk I(MB/s)|QPS|
| :----:| :----: |:----:|:----:|:----:|:----:|
|1 | 75 |12.22 |363.48/37.82|360.37 |309763|  
|2 | 76 |12.22 |360.67/37.07|353.79 |308037|   
|3 | 19 |11.88 |886.11/4.63 |1376.31|32961776|
|4 | 46 |10.1|686.44/1172.51|1034.93|25018477|

上表的实验结果表明，压缩对单条消息的生产的性能几乎没有影响，但对批量消息的性能提升比较大，大批量消息有利于提升CPU和磁盘利用率。无论是单条还是批量消息，JournalQ都能保持很高的吞吐量。
